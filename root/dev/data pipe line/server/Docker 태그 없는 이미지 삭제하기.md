---
tags:
  - docker
  - command
  - tip
create: 2024-08-03 17:51:46
---
## 태그 없는 이미지 정리하기

Docker 명령어를 사용해서 태그가 없는 이미지(즉, `<none>`으로 표시된 이미지)를 제거할 수 있어. 주로 사용되는 명령어는 `docker image prune`이야. 이 명령어는 사용하지 않는(dangling) 이미지를 삭제해줘.

먼저, 모든 사용하지 않는 이미지를 정리하고 싶으면 다음 명령어를 사용할 수 있어:

```sh
docker image prune -a
```

하지만 이 명령어는 태그가 있는 사용되지 않는 이미지도 삭제하니까 주의해야 해.

만약 태그가 없는 이미지들만 정리하고 싶다면, 다음 명령어를 사용하면 돼:

```sh
docker images purge $(docker images -f "dangling=true" -q)
```

위 명령어들은 아래와 같은 상황에서 실행될 수 있어:

1. 모든 사용하지 않는 이미지(태그 있는 것과 없는 것 모두)를 삭제하고 싶을 때:
```sh
docker image prune -a
```

2. 태그가 없는 이미지들만 삭제하고 싶을 때:
```sh
docker image prune
```

위 명령어들을 실행하면 이미지를 정리할 수 있어. 정리한 후 다시 이미지를 확인하고 싶으면 `docker image ls -a`를 다시 실행하면 돼.

---

## 의존성이 있는 이미지 처리하기

태그 없는 이미지들을 삭제할 때, 그 이미지들이 다른 이미지의 기반이 되는 경우 영향을 미칠 수 있어. 다만, Docker는 기본적으로 실제로 사용되고 있는 이미지를 삭제하지 않기 때문에, 태그가 없는 이미지 중에서도 다른 이미지들이 의존하는 경우에는 삭제되지 않아.

안전하게 태그 없는 이미지를 삭제하기 위해 `docker image prune` 명령어를 사용하면 돼. 이 명령어는 사용되지 않는(dangling) 이미지들만 삭제하기 때문에, 다른 이미지에 영향을 주지 않아.

```sh
docker image prune
```

이 명령어는 태그가 없는 사용되지 않는 이미지들만 삭제해.

만약 정말로 태그가 없는 이미지들이 사용 중인지 확인하고 싶다면, 아래 명령어로 확인할 수 있어:

```sh
docker images -f "dangling=true"
```

이 명령어는 태그가 없는 이미지들만 표시해줘. 그리고 나서 안전하게 삭제할 수 있어.

마지막으로, 이미지 간의 의존성을 파악하기 위해선 `docker image inspect` 명령어를 사용할 수 있어:

```sh
docker image inspect <IMAGE_ID>
```

이 명령어로 특정 이미지의 상세 정보를 확인할 수 있어. 이를 통해 이미지 간의 관계를 이해하고 삭제 여부를 결정할 수 있어.

---

의존성이 있는 이미지를 다룰 때는 신중해야 해. 이미지 간의 의존성을 확인하고 적절하게 처리하기 위한 몇 가지 방법이 있어.

1. **의존성 확인**:
`docker image inspect` 명령어를 사용해서 이미지의 상세 정보를 확인하고, 이미지 간의 의존성을 파악해. 예를 들어, 특정 이미지의 부모 이미지가 무엇인지 확인할 수 있어.

```sh
docker image inspect <IMAGE_ID>
```

2. **이미지 태그 변경**:
만약 특정 이미지가 다른 이미지에 의존하고 있고 태그가 없는 경우, 의존성 문제를 피하기 위해 태그를 추가해. 

```sh
docker tag <IMAGE_ID> <new_tag>
```

3. **필요 없는 이미지 삭제**:
의존성이 없는 태그가 없는 이미지들을 안전하게 삭제하기 위해 `docker image prune` 명령어를 사용해.

```sh
docker image prune
```

이 명령어는 다른 이미지에 의존하지 않는 사용되지 않는(dangling) 이미지만 삭제해.

4. **필요한 이미지 백업**:
의존성이 있는 이미지라도 삭제가 필요한 경우, 이미지를 백업한 후 삭제할 수 있어. 이미지를 백업하려면 `docker save` 명령어를 사용해.

```sh
docker save -o <output_file.tar> <IMAGE_ID>
```

백업 후 필요 시 `docker load` 명령어로 이미지를 복원할 수 있어.

```sh
docker load -i <output_file.tar>
```

5. **이미지 정리 후 확인**:
이미지를 삭제하거나 정리한 후, 다시 이미지 리스트를 확인하고 의도치 않은 이미지 삭제가 없는지 확인해.

```sh
docker image ls -a
```

요약하자면, 의존성이 있는 이미지를 처리하기 전에 반드시 의존성을 확인하고, 필요 시 태그를 변경하거나 백업을 진행한 후 안전하게 삭제해.